{-# LANGUAGE OverloadedStrings #-}
module Data.Kafka.ExampleKafkaProducerOrderTopic where

import Control.Monad   (forM_)
import Data.ByteString (ByteString)
import Data.Monoid
import Kafka.Producer

-- Global producer properties
producerProps :: ProducerProperties
producerProps = brokersList [BrokerAddress "localhost:9092"]
             <> logLevel KafkaLogDebug

-- Topic to send messages to
targetTopic :: TopicName
targetTopic = TopicName "product_recall_order"

mkMessage :: Maybe ByteString -> Maybe ByteString -> ProducerRecord
mkMessage k v = ProducerRecord
                  { prTopic = targetTopic
                  , prPartition = UnassignedPartition
                  , prKey = k
                  , prValue = v
                  }

-- Run an example
runProducerExample :: IO ()
runProducerExample = do
    res <- runProducer producerProps sendMessages
    print res

sendMessages :: KafkaProducer -> IO (Either KafkaError ())
sendMessages prod = do

  errs <- produceMessageBatch prod
            [ mkMessage (Just "\"StockServiceKey\"") (Just "{\"id\":\"f066eec5-1c0b-4097-bda5-0f7eec1a03a8\",\"key\":\"somekey19\",\"time\":\"2017-09-29T20:00:00+01:00\",\"type\":\"typeValue\",\"channel\":\"channelValue\",\"storeId\":\"111111\",\"tenant\":\"REWE\",\"payloadId\":\"asnID\",\"payload\":{ \"metaData\": {    \"channel\": \"\",    \"revision\": \"1\",    \"lastModified\": \"2017-08-04T07:12:39.039+0000\"  },  \"orderDate\": \"2015-12-28T08:44:00.000+0000\",  \"customerType\": \"PERSONAL\",  \"payment\": {    \"paymentData\": \"\",    \"paymentReferenceNumber\": \"41400501150511500006\",    \"paymentMethod\": \"Visa\"  },  \"invoiceAddress\": {    \"addressAddition\": \"...\",    \"companyAddition1\": \"...\",    \"companyName\": \"PlanetIlltis\",    \"houseNumber\": \"123\",    \"salutation\": \"HERR\",    \"zipCode\": \"20255\",    \"street\": \"Heußweg\",    \"companyAddition2\": \"...\",    \"title\": \"Dr.\",    \"lastName\": \"Marx\",    \"phoneNumber2\": \"0123456789\",    \"firstName\": \"Karl\",    \"phoneNumber\": \"0123456789\",    \"city\": \"Hamburg\",    \"country\": \"DE\"  },  \"deliveryType\": \"DELIVERY\",  \"customOrderData\": \"\",  \"status\": \"open\",  \"storeId\": \"111111\",  \"orderValue\": \"8990\",  \"timeSlot\": {    \"lastSlotDate\": \"2015-12-28T08:44:00.000+0000\",    \"firstSlotDate\": \"2017-12-28T08:44:00.000+0000\"  },  \"lineItems\": [    {      \"barcodes\": \"\",      \"basePrice\": \"2100\",      \"productTitle\": \"Einhorn Bier 6x0,33l\",      \"lineNumber\": \"1\",      \"totalPrice\": \"4200\",      \"targetItemNumbers\": \"\",      \"itemState\": \"ORDERED\",      \"articleId\": \"4000007050974\",      \"quantity\": \"2\",      \"quantityUnit\": \"PC\",      \"itemNumber\": \"1\",      \"lineItemData\": \"\"    },    {      \"itemState\": \"ORDERED\",      \"articleId\": \"4000007050975\",      \"quantity\": \"2\",      \"quantityUnit\": \"PC\",      \"itemNumber\": \"2\",      \"lineItemData\": \"\",      \"barcodes\": \"\",      \"basePrice\": \"2100\",      \"productTitle\": \"Dachsbräu Lager 6x0,5l\",      \"lineNumber\": \"2\",      \"totalPrice\": \"4200\",      \"targetItemNumbers\": \"\"    }  ],  \"userComment\": \"Bitte keine Ersatzartikel\",  \"id\": \"1-001-abc-k-20170804-2\",  \"deliveryAddress\": {    \"country\": \"DE\",    \"addressAddition\": \"...\",    \"companyAddition1\": \"...\",    \"companyName\": \"PlanetIlltis\",    \"houseNumber\": \"123\",    \"salutation\": \"HERR\",    \"zipCode\": \"20255\",    \"street\": \"Heußweg\",    \"companyAddition2\": \"...\",    \"title\": \"Dr.\",    \"lastName\": \"Marx\",    \"phoneNumber2\": \"0123456789\",    \"firstName\": \"Karl\",    \"phoneNumber\": \"0123456789\",    \"city\": \"Hamburg\"  },  \"customerNumber\": \"1234567\"}}")
            , mkMessage (Just "\"StockServiceKey\"") (Just "{\"id\":\"886fc037-9974-4f46-a2e2-5cfd84a959a8\",\"key\":\"somekey18\",\"time\":\"2017-09-29T20:00:00+01:00\",\"type\":\"typeValue\",\"channel\":\"channelValue\",\"storeId\":\"111111\",\"tenant\":\"REWE\",\"payloadId\":\"asnID\",\"payload\":{  \"metaData\": {    \"channel\": \"\",    \"revision\": \"1\",    \"lastModified\": \"2017-08-04T07:12:39.039+0000\"  },  \"orderDate\": \"2015-12-28T08:44:00.000+0000\",  \"customerType\": \"PERSONAL\",  \"payment\": {    \"paymentData\": \"\",    \"paymentReferenceNumber\": \"41400501150511500006\",    \"paymentMethod\": \"Visa\"  },  \"invoiceAddress\": {    \"addressAddition\": \"...\",    \"companyAddition1\": \"...\",    \"companyName\": \"PlanetIlltis\",    \"houseNumber\": \"123\",    \"salutation\": \"HERR\",    \"zipCode\": \"20255\",    \"street\": \"Heußweg\",    \"companyAddition2\": \"...\",    \"title\": \"Dr.\",    \"lastName\": \"Marx\",    \"phoneNumber2\": \"0123456789\",    \"firstName\": \"Karl\",    \"phoneNumber\": \"0123456789\",    \"city\": \"Hamburg\",    \"country\": \"DE\"  },  \"deliveryType\": \"DELIVERY\",  \"customOrderData\": \"\",  \"status\": \"open\",  \"storeId\": \"111111\",  \"orderValue\": \"8990\",  \"timeSlot\": {    \"lastSlotDate\": \"2015-12-28T08:44:00.000+0000\",    \"firstSlotDate\": \"2017-12-28T08:44:00.000+0000\"  },  \"lineItems\": [    {      \"barcodes\": \"\",      \"basePrice\": \"2100\",      \"productTitle\": \"Einhorn Bier 6x0,33l\",      \"lineNumber\": \"1\",      \"totalPrice\": \"4200\",      \"targetItemNumbers\": \"\",      \"itemState\": \"ORDERED\",      \"articleId\": \"4000007050974\",      \"quantity\": \"2\",      \"quantityUnit\": \"PC\",      \"itemNumber\": \"1\",      \"lineItemData\": \"\"    },    {      \"itemState\": \"ORDERED\",      \"articleId\": \"4000007050975\",      \"quantity\": \"2\",      \"quantityUnit\": \"PC\",      \"itemNumber\": \"2\",      \"lineItemData\": \"\",      \"barcodes\": \"\",      \"basePrice\": \"2100\",      \"productTitle\": \"Dachsbräu Lager 6x0,5l\",      \"lineNumber\": \"2\",      \"totalPrice\": \"4200\",      \"targetItemNumbers\": \"\"    }  ],  \"userComment\": \"Bitte keine Ersatzartikel\",  \"id\": \"1-001-abc-k-20170804-2\",  \"deliveryAddress\": {    \"country\": \"DE\",    \"addressAddition\": \"...\",    \"companyAddition1\": \"...\",    \"companyName\": \"PlanetIlltis\",    \"houseNumber\": \"123\",    \"salutation\": \"HERR\",    \"zipCode\": \"20255\",    \"street\": \"Heußweg\",    \"companyAddition2\": \"...\",    \"title\": \"Dr.\",    \"lastName\": \"Marx\",    \"phoneNumber2\": \"0123456789\",    \"firstName\": \"Karl\",    \"phoneNumber\": \"0123456789\",    \"city\": \"Cologne\"  },  \"customerNumber\": \"1234567\"}}")
            , mkMessage (Just "\"StockServiceKey\"") (Just "{\"id\":\"a9bee46d-a42c-4310-a4e3-22b928236c07\",\"key\":\"somekey111\",\"time\":\"2017-09-29T20:00:00+01:00\",\"type\":\"typeValue\",\"channel\":\"channelValue\",\"storeId\":\"111111\",\"tenant\":\"REWE\",\"payloadId\":\"asnID\",\"payload\":{  \"metaData\": {    \"channel\": \"\",    \"revision\": \"1\",    \"lastModified\": \"2017-08-04T07:12:39.039+0000\"  },  \"orderDate\": \"2015-12-28T08:44:00.000+0000\",  \"customerType\": \"PERSONAL\",  \"payment\": {    \"paymentData\": \"\",    \"paymentReferenceNumber\": \"41400501150511500006\",    \"paymentMethod\": \"Visa\"  },  \"invoiceAddress\": {    \"addressAddition\": \"...\",    \"companyAddition1\": \"...\",    \"companyName\": \"PlanetIlltis\",    \"houseNumber\": \"123\",    \"salutation\": \"HERR\",    \"zipCode\": \"20255\",    \"street\": \"Heußweg\",    \"companyAddition2\": \"...\",    \"title\": \"Dr.\",    \"lastName\": \"Marx\",    \"phoneNumber2\": \"0123456789\",    \"firstName\": \"Karl\",    \"phoneNumber\": \"0123456789\",    \"city\": \"Hamburg\",    \"country\": \"DE\"  },  \"deliveryType\": \"DELIVERY\",  \"customOrderData\": \"\",  \"status\": \"open\",  \"storeId\": \"111111\",  \"orderValue\": \"8990\",  \"timeSlot\": {    \"lastSlotDate\": \"2015-12-28T08:44:00.000+0000\",    \"firstSlotDate\": \"2017-12-28T08:44:00.000+0000\"  },  \"lineItems\": [    {      \"barcodes\": \"\",      \"basePrice\": \"2100\",      \"productTitle\": \"Einhorn Bier 6x0,33l\",      \"lineNumber\": \"1\",      \"totalPrice\": \"4200\",      \"targetItemNumbers\": \"\",      \"itemState\": \"ORDERED\",      \"articleId\": \"4000007050974\",      \"quantity\": \"2\",      \"quantityUnit\": \"PC\",      \"itemNumber\": \"1\",      \"lineItemData\": \"\"    },    {      \"itemState\": \"ORDERED\",      \"articleId\": \"4000007050975\",      \"quantity\": \"2\",      \"quantityUnit\": \"PC\",      \"itemNumber\": \"2\",      \"lineItemData\": \"\",      \"barcodes\": \"\",      \"basePrice\": \"2100\",      \"productTitle\": \"Dachsbräu Lager 6x0,5l\",      \"lineNumber\": \"2\",      \"totalPrice\": \"4200\",      \"targetItemNumbers\": \"\"    }  ],  \"userComment\": \"Bitte keine Ersatzartikel\",  \"id\": \"1-001-abc-k-20170804-2\",  \"deliveryAddress\": {    \"country\": \"DE\",    \"addressAddition\": \"...\",    \"companyAddition1\": \"...\",    \"companyName\": \"PlanetIlltis\",    \"houseNumber\": \"123\",    \"salutation\": \"HERR\",    \"zipCode\": \"20255\",    \"street\": \"Heußweg\",    \"companyAddition2\": \"...\",    \"title\": \"Dr.\",    \"lastName\": \"Marx\",    \"phoneNumber2\": \"0123456789\",    \"firstName\": \"Karl\",    \"phoneNumber\": \"0123456789\",    \"city\": \"Jena\"  },  \"customerNumber\": \"1234567\"}}")
            ]

  forM_ errs (print . snd)
  return $ Right ()
